<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Enigma 2 :)</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="enigma2.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
    <style>


    </style>
    <script>
        var $$ = document.querySelectorAll.bind(document);
        var collection ;
        var state = {
            step:0,
            findedNumber: 0
        };
        var cubeOneSwape = null,
            cubeTwoSwape = null
        ;


        window.addEventListener('load',function () {
            shuffle( $$('#container')[0] );
            collection = $$('#container div');

            state.findedNumber = (Math.random()* collection.length) | 0;
            renderState();

            $('#container div').on('click', function () {
//                markNext.call(this);
//                state.step++;
//                renderState();
                this.classList.add('marked');
                swapCube(this)

            });

//            $('#container div').on('mouseenter',function point(me){
//                var num = this.innerText * 1;
//                var referal = collection[num-1];
//                referal.classList.add('marked')
//            })
        });



        function circle(color, indexStart ){
            var index = indexStart;
            var $circle = $('<div class="circle">');
            while(true){
                var node = collection[ index ];
//                node.classList.add('marked');
                node.classList.add('touched');
                node.style.backgroundColor = color;
                index = (node.innerText * 1) -1;
                $circle.append( node.cloneNode(true) );
                if(index == indexStart){
                    break;
                }
            }
            $('.circles').append( '<h1>'+ $circle.children().length  +" steps</h1>" );
            $('.circles').append( $circle );
        }

        function markCircles(){
            for (var i = 0; i < collection.length; i++) {
                if(collection[i].classList.contains("touched"))
                    continue;
                var color = randomColor();
                circle(color,i);

            }
        }

        function swapCube(cube){
            if(!cubeOneSwape){
                cubeOneSwape = cube;
                return ;
            }
            if(!cubeTwoSwape){
                cubeTwoSwape = cube;
            }
            container.replaceChild(cubeOneSwape.cloneNode(true),cubeTwoSwape);
            container.replaceChild(cubeTwoSwape.cloneNode(true),cubeOneSwape);


        }

        function markNext(){
            var num = this.innerText * 1;
            var referal = collection[num-1];
            referal.classList.add('marked')
        }


        function randomColor() {
//            var letters = '0123456789ABCDEF'.split('');
            var letters = '23456789ABC'.split('');
            var color = '#';
            for (var i = 0; i < 3; i++ ) {
                color += letters[Math.random() * letters.length | 0];
            }
            return color;
        }

        function shuffle( container ){
            for (var i = container.children.length; i >= 0; i--) {
                container.appendChild(container.children[Math.random() * i | 0]);
            }
        }

        function renderState(){
            $('#step').html(state.step);
            $('#find').html(state.findedNumber);
        }

        function reset(){
            for (var i = container.children.length; i > 0; i--) {
                var node = container.children[i-1];
                node.removeAttribute('style');
                node.classList.remove('touched');
            }
            circles.innerHTML = '';
        }

    </script>
</head>
<body>
    <div id="container">
        <div class="cube">
            <div class="front">1</div>
            <div class="back">2</div>
            <div class="right">3</div>
            <div class="left">4</div>
            <div class="top">5</div>
            <div class="bottom">6</div>
        </div>
        <div class="cube">
            <div class="front">1</div>
            <div class="back">2</div>
            <div class="right">3</div>
            <div class="left">4</div>
            <div class="top">5</div>
            <div class="bottom">6</div>
        </div>
    </div>

    <div style="clear: left; ">
        <button onclick="markCircles()">Mark Circles</button>
        <button onclick="reset()">Reset</button>
    </div>

    <div id="circles">

    </div>




    <div class="stat">
        <div>
            find: <span id="find"></span>

        </div>
        <div>
            step: <span id="step"></span>
        </div>
    </div>
</body>
</html>